<!DOCTYPE html>
<html>
    <title>Saumya-TATA MOTORS</title>
    <meta charset="utf-8">
    <link rel="stylesheet" href="style.css">

    <style>

        li{
            border:1px solid #0E8388;
        }
    </style>


    <body>
      <nav>
        <span><h3>HOSPITAL NAME</h3></span>
        <span><a href="/">Logout</a></span>
      </nav>
      
      <div class="main">

        <div class="left">
            <section id="doc" style="display:block;padding:12px;">
                <!-- <table>
                    <tr>
                        <th>Doctors Available</th>
                        
                    </tr>
                    <tr>
                       <td> Smita PShekhar</td>
                      
                    </tr>
                 
                </table> -->
                <h5>Doctors Available</h5>
                <ul id="docslist">
                  <li>Doctor One</li>
                </ul>
            </section>

            <section id="pats" style="display:block; padding:12px; border-color:#0E8388;">
              <h5>Patients Waiting</h5>
               <ul id="patslist">
                <li>Saumya Sejal</li>
               </ul>

            </section>
            
          </div>
          
          <div class="right">
            <form id="registerPatient"  onsubmit="validate(event)">
              <h2>Register</h2>
              <p id="right-msg" style="color:crimson;"></p>
              <label for="fname">First Name:</label>
              <input type="text" id="fname" name="fname" required><br>
              <label for="lname">Last Name:</label>
              <input type="text" id="lname" name="lname" required><br><br>
              <label for="ph">Phone no:</label>
              <input type="tel" id="ph" name="ph" required><br><br>
              <label for="email">Email:</label>
              <input type="email" id="email" name="email" required><br><br>
              <label for="age">Age:</label>
              <input type="number" id="age" name="age" required><br><br>
              <label for="gender">Gender:</label>
              <select id="gender">
                <option value="male">Male</option>
                <option value="female">Female</option>
              </select><br>
              <hr noshade="true" color="#0E8388">
              <label for="pswd">Password:</label>
              <input type="password" id="pswd" name="pswd" required><br><br>
              <label for="confpswd">Confirm Password:</label>
              <input type="password" id="confpswd" name="confpswd" required><br><br>
              <input type="submit" value="Register" id="submit">
            </form>

            
          </div>

      </div>
  
      <script>

                  //dynamic validation of form using event listner 
                  var fnameEl=document.getElementById('fname');
           var lnameEl=document.getElementById('lname');
           var phoneEl=document.getElementById('ph');
           var mailEl=document.getElementById('email');
           var AgeEl=document.getElementById('age');
           var PasswordEl=document.getElementById('pswd');
           var ConfPasswordEl=document.getElementById('confpswd');

           fnameEl.addEventListener('input',fnamevalidate); 
           lnameEl.addEventListener('input',lnamevalidate); 
           phoneEl.addEventListener('input',phonevalidate);
           mailEl.addEventListener('input',emailvalidate); 
           AgeEl.addEventListener('input',agevalidate);
           PasswordEl.addEventListener('input',pswdvalidate);
           ConfPasswordEl.addEventListener('input',confpswdvalidate);
           
            const unamepat = /^[A-Za-z]+$/;
           
            function fnamevalidate(){
              const unamepat = /^[A-Za-z]+$/;
              var fnameVal=fnameEl.value;
              var fnameMatch=unamepat.test(fnameVal);
              if(!fnameMatch){
                document.getElementById('right-msg').innerText="Name must be only letters";
                fnameEl.style.color="crimson";
              }
              else{
                document.getElementById('right-msg').innerText="";
                fnameEl.style.color="#0E8388";
              }
            }


            function lnamevalidate(){
              const unamepat = /^[A-Za-z]+$/;
              var lnameVal=lnameEl.value;
              var lnameMatch=unamepat.test(lnameVal);
              if(!lnameMatch){
                document.getElementById('right-msg').innerText="Name must be only letters";
                lname.style.color="crimson";
              }
              else{
                document.getElementById('right-msg').innerText="";
                lnameEl.style.color="#0E8388";
              }
            }

            function phonevalidate(){
              
              const phpat = /^[0-9]{10}$/;
              var phoneVal=phoneEl.value;
              var phoneMatch=phpat.test(phoneVal);
              if(!phoneMatch){
                document.getElementById('right-msg').innerText="Phone no. must be only 10-digits";
                phoneEl.style.color="crimson";
              }
              else{
                document.getElementById('right-msg').innerText="";
                phoneEl.style.color="#0E8388";
              }
            }

            function emailvalidate(){
              
              const mailpat =/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;
              var mailVal=mailEl.value;
              var mailMatch=mailpat.test(mailVal);
              if(!mailMatch){
                document.getElementById('right-msg').innerText="Email must contain '@' and subdomain";
                mailEl.style.color="crimson";
              }
              else{
                document.getElementById('right-msg').innerText="";
                mailEl.style.color="#0E8388";
              }
            }

            function agevalidate(){
              
              // const phpat = /^[0-9]{10}$/;
              var ageVal=AgeEl.value;
              
              if(Number(ageVal)>99){
                document.getElementById('right-msg').innerText="age must be 2 digits";
                phoneEl.style.color="crimson";
              }
              else{
                document.getElementById('right-msg').innerText="";
                phoneEl.style.color="#0E8388";
              }
            }

            function pswdvalidate(){
              var pswdVal=String(PasswordEl.value);
              const pswdpat=/^$/;
              if(pswdVal.length<8){
                document.getElementById('right-msg').innerText='the password must be atleast 8 characters long';
                phoneEl.style.color="crimson";
              }
              else{
                document.getElementById('right-msg').innerText="";
                phoneEl.style.color="#0E8388";  
              }

            }

            function confpswdvalidate(){
              var confpswdVal=String(ConfPasswordEl.value);
              var pswdVal=String(PasswordEl.value);
              
              if(confpswdVal != pswdVal){
                document.getElementById('right-msg').innerText='the confirm password must be same as password';
                phoneEl.style.color="crimson";
              }
              else{
                document.getElementById('right-msg').innerText="";
                phoneEl.style.color="#0E8388";  
              }

            }

document.addEventListener('DOMContentLoaded', () => {
      // Fetch data from the /data route
      //alert('entered the onload event');
      fetch('/doctorslist')
        .then(
          
          response => response.json()
        )
        .then(json => {
          // Process the data and display it on the page
          console.log("entered then of docotrs fetch function")
          const dataList = document.getElementById('docslist');
          data.forEach(item => {
            const listItem = document.createElement('li');
            listItem.textContent = item.name; // Assuming the data has a "name" field
            dataList.appendChild(listItem);
          });
        })
        .catch(error => {
          console.error('Failed to fetch data:', error);
        });


        fetch('/patientslist')
        .then(
          
          response => response.json()
        )
        .then(json => {
          // Process the data and display it on the page
          console.log("entered then of docotrs fetch function")
          const dataList = document.getElementById('patslist');
          data.forEach(item => {
            const listItem = document.createElement('li');
            listItem.textContent = item.name; // Assuming the data has a "name" field
            dataList.appendChild(listItem);
          });
        })
        .catch(error => {
          console.error('Failed to fetch data:', error);
        });
    
    }
    
    

    
    );

        function validate(event) {
event.preventDefault(); // Prevent the default form submission

var fname = String(document.getElementById("fname").value);
var lname = String(document.getElementById("lname").value);
var phone = String(document.getElementById("ph").value);
var mail = String(document.getElementById("email").value);
var age = String(document.getElementById("age").value);
var numAge = Number(age);
var gender=String(document.getElementById('gender').value);

const phpat = /^[0-9]{10}$/;
const unamepat = /^[A-Za-z]+$/;
const mailpt = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
const agepat = /^[0-9]{2}/;

let fnamematch = unamepat.test(fname);
let lnamematch = unamepat.test(lname);
let phmatch = phpat.test(phone);
let mailmatch = mailpt.test(mail);
let agematch = agepat.test(age);

if (!fnamematch || !lnamematch || !phmatch || !mailmatch || numAge < 0 || numAge > 100 || pswd.length<8 || confpswd != pswd) {
  console.log("Validation failed");
  document.getElementById("right-msg").innerText = "Please fill in all the information correctly";
  return false;
}

console.log("Validation passed");

// Prepare the form data to send to the server
const myForm=document.getElementById('registerPatient');

const formData = new FormData(myForm);
formData.append('gender',gender);
const data=new URLSearchParams(formData);
// formData.append('fname',fname);
// formData.append('lname',lname);
// formData.append('ph',phone);
// formData.append('age',age);


console.log(formData);

// Send the form data to the server using Fetch API
fetch("/registerpatient", {
  method: "POST",
  body: data
})
.then(response => {
  if (response.ok) {
    console.log("Form data submitted successfully");
    return response.text();
    
  }
  throw new Error("Form submission failed");
})
.then(data => {
  console.log(data); // Handle the response from the server if needed
  window.location.href = "register_success.html"; // Redirect to success page
})
.catch(error => {
  console.log(error);
  document.getElementById("right-msg").innerText = "Form submission failed. Please try again.";
});
}

        

      </script>
    </body>
</html>